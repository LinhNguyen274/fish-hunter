const _G="undefined"==typeof window?global:window;cc.CollisionManager.prototype.shouldCollide=function(e,t){const n=e.node;if(!n)return!1;const o=t.node;if(!o)return!1;const r=cc.game.collisionMatrix;try{if(-1===n.groupIndex||-1===o.groupIndex)return!0;const e=r[n.groupIndex][o.groupIndex];return n!==o&&e}catch(i){return console.error(">>>>>",i),console.error(">>>>>",r[n.groupIndex]),console.error(">>>>>",n.groupIndex,o.groupIndex),console.error("------------------------------------"),!1}};const roman_numerals=[{value:1e3,symbol:"M"},{value:900,symbol:"CM"},{value:500,symbol:"D"},{value:400,symbol:"CD"},{value:100,symbol:"C"},{value:90,symbol:"XC"},{value:50,symbol:"L"},{value:40,symbol:"XL"},{value:10,symbol:"X"},{value:9,symbol:"IX"},{value:5,symbol:"V"},{value:4,symbol:"IV"},{value:1,symbol:"I"}],money_formater_arr=[{div:1e9,dex:"B"},{div:1e6,dex:"M"},{div:1e3,dex:"K"}];function money_formater_mechanic(e,t,n){return(e/t).toFixed(1).replace(/\.0$/,"")+n}const dayMMS=864e5;function uuid_generator(){return`${random_character()}_${Date.now()}_${Math.floor(900*Math.random())+100}`}function char_replacer_at(e,t,n){return e.length<=t&&(e=e.padEnd(t," ")),e.substring(0,t)+n+e.substring(t+1)}function random_character(e=!1){const t=26*Math.random()>>0,n=e?Math.random()<.5?65:97:65;return String.fromCharCode(n+t)}class pSchedulerOnce{constructor(){this._pool={}}register(e,t,n,o=null,...r){const i="string"==typeof e?e:void 0;return i||({callback:t,delay:n,params:r,binder:o}=e),this._pool[i]={callback:t,delay:n,params:r,binder:o},i}invoke(e,t){const n=this._pool[e];if(n){switch(typeof t){case"undefined":break;case"number":n.delay=t;break;default:if(Array.isArray(t)){n.params=t;break}t.params&&(n.params=t.params),t.delay&&(n.delay=t.delay),n.binder=t.binder,cc.log(">>>>>>>>>>>>>>>>>>>",t)}clearTimeout(n._to_),n._to_=setTimeout(()=>{n.callback.call(n.binder,...n.params)},1e3*n.delay)}}stop(e){const t=this._pool[e];t&&clearTimeout(t._to_)}}class pItems{constructor(){this._executors={}}execute_item(e,t,n,...o){const r=cc.RedT.user.item[e];r&&(this._executors[r.group]=t,"string"==typeof n&&cc.systemEvent.emit(n,...o))}get_item_executor(e){const t=cc.RedT.user.item[e];if(!t)return!1;const n=this._executors[t.group];return void 0!==n&&n}get_items_executor(...e){return e.some(e=>this.get_item_executor(e))}revoke_all(){for(const e in this._executors)this._executors[e]=!1}}class pTween{constructor(){this._memory={}}_quick_opt(e){const t=`__to_num_${Date.now()}_${1e3*Math.random()>>1}`;return{id:"number"==typeof e?t:e.id||t,duration:1e3*("number"==typeof e?e:e.duration||1),step:"number"==typeof e?16:e.step||16,log:"number"==typeof e||e.log||!0}}stop_tween(...e){for(const t of e)null!=t&&null!=this._memory[t]&&(clearInterval(this._memory[t]),delete this._memory[t])}tween_interval(e,t,n,o,r){e=this._quick_opt(e),this.stop_tween(e.id);const i=Math.max(1,Math.round(e.duration/e.step));let c=0;return this._memory[e.id]=setInterval(()=>{const n=t(++c,i);o&&o(n),c>=i&&(this.stop_tween(e.id),o&&o(n),r&&r())},e.step),e.log&&n&&n(e,i,this._memory[e.id]),e.id}to_number(e,t,n,o,r){const i=t-e;return this.tween_interval(n,(t,n)=>e+i/n*t,(e,t,n)=>{cc.log("pTween >>> To Number:\n\t\t>> OPTs: ",e,"\n\t\t>> Total:",t,"\n\t\t>> Id:",n)},o,r)}spining_text(e,t,n,o){if(null==e)return;t=this._quick_opt(t);const r=e.length,i=t.duration/(r-1)/1e3;let c=0,s="";const a=e=>{s=char_replacer_at(s,c,e),n&&n(s)},l=()=>{a(e[c]),++c>=r?o&&o():this.spining_char({duration:i,key:`__spining_text_${t.key}__`},a,l)};this.spining_char({duration:i,key:`__spining_text_${t.key}__`},a,l)}spining_char(e,t,n){return this.tween_interval(e,random_character,(e,t,n)=>{cc.log("pTween >>> Spining Char:\n\t\t>> OPTs: ",e,"\n\t\t>> Total:",t,"\n\t\t>> Id:",n)},t,n)}}class pSignal{constructor(){this._container={}}add(e,t,...n){const o={},r=[t,...n].flat();for(const i of r)o[i.id||uuid_generator()]="function"==typeof i?i:i.method;return this._container[e]={...this._container[e],...o},Object.keys(o)}invoke(e,t=null,...n){const o=this._container[e];if(!o)return;const r={};for(const[i,c]of Object.entries(o))r[i]=c();return r}invokes(e,t,...n){const o={};for(const r of e)o[r]=this.invoke(r,t,...n);return o}removes(e,t,...n){const o=this._container[e];if(!o)return;const r=[t,...n].flat();for(const i of r)delete o[i]}clean(e){delete this._container[e]}}class pTSHelper{constructor(){this.random_character=random_character,this.uuid_generator=uuid_generator,this.char_replacer_at=char_replacer_at,this.scheduler=new pSchedulerOnce,this.builtin={},this.fxc={},this.args={item:new pItems,_:{array:[],obj:{}}},this.signal=new pSignal,this.tween=new pTween}add_click_event_for_button(e,t,n,o,r){const i=t.getComponent(n);if(!i)return;if(!Object.getOwnPropertyNames(i.constructor.prototype).includes(o))return;const c=new cc.Component.EventHandler;c.target=t,c.component="string"==typeof n?n:cc.js.getClassName(i),c.handler=o,c.customEventData=r,e.clickEvents.push(c)}set_click_event_for_button(e,t,n,o,r){e.clickEvents=[],this.add_click_event_for_button(e,t,n,o,r)}is_vec2_equal(e,t){return e.x==t.x&&e.y===t.y}is_vec3_equal(e,t){return e.x==t.x&&e.y===t.y&&e.z===t.z}get_local_position(e,t){if(t instanceof cc.Node){if(e.parent===t.parent)return t.position;const n=t.convertToWorldSpaceAR(cc.v3());return e.parent.convertToNodeSpaceAR(n)}return t.is_world_pos?e.parent.convertToNodeSpaceAR(t.position):t.position}set_position(e,t){e.setPosition(this.get_local_position(e,t))}chain_sp_anim(e,t,n){const o=t.length;this.settup_skeleton(e,n);const r=null==n.loop_at_end||n.loop_at_end,i=null!=n.anim_track_id?n.anim_track_id:0;if(o>=2){target.setAnimation(0,t[0],!1);for(let n=0;n<o;n++)n===o-1&&r?e.addAnimation(i,t[n],!0):e.addAnimation(i,t[n],!1)}else e.setAnimation(i,i[0],r)}settup_skeleton(e,t){if(!t||!e)return;const n=null!=t.time_scale?t.time_scale:e.timeScale;e.timeScale=n;const o=t.mixin;o&&o.enable&&this.mixin_skeleton(e,o)}mixin_skeleton(e,t){const n=new sp.spine.AnimationStateData(e.skeletonData.getRuntimeData()),o=null!=t&&null!=t.default_mixin_duration?t.default_mixin_duration:1/6;if(n.defaultMix=o,null!=t&&null!=t.options)for(const r of t.options)n.setMix(r.from,r.to,r.duration);e.setAnimationStateData(n)}get_possible_component(e,...t){for(const n of t){const t=e.getComponent(n);if(t)return t}return null}number_to_short_money(e){for(const t of money_formater_arr)if(e>=t.div)return money_formater_mechanic(e,t.div,t.dex);return e.toString()}en_number(e){return e.toLocaleString("en-US").replace(/,/g,".")}check_component_in_prefab(e,t,n=!1){return!1}to_date_day_num(e){return Math.floor(e/dayMMS)}day_differ(e){return this.to_date_day_num(Date.now())-this.to_date_day_num(e)}random_int(e,t){return e=Math.ceil(e),e=Math.ceil(t),Math.floor(Math.random()*(t-e+1))+e}editbox_binder(e,t,n,o=null){if(!e instanceof cc.EditBox)return;if(!e._impl)return;const r=e._impl._elem;r&&r.addEventListener(t,n,o)}game_focus(){cc.sys.isBrowser&&document.getElementsByTagName("canvas")[0].focus()}children_checker(e,...t){return t.every(t=>!!e.getChildByName(t))}children_checker_detail(e,...t){const n={};for(const o of t){const t=e.getChildByName(o);n[o]=t||null}return n}children_checker_detail_array(e,...t){const n=[];for(const o of t){const t=e.getChildByName(o);n.push({key:o,data:t||null})}return n}children_checker_comps_detail(e,...t){return t.every(t=>{const n=e.getChildByName(t.name);return!!n&&t.comps.every(e=>!!n.getComponent(e))})}number_extractor(e){const t=e.match(/\d+/g);return t?t.map(Number):[]}to_number(e){const t=e.match(/\d+/g);return t?Number(t.join("")):0}find_biggest(e,t){return"string"==typeof t&&e[0].property?e.reduce((e,n)=>n[t]>e[t]?n:e):"function"==typeof t?e.reduce(t):void 0}quick_rect(e,t=!0,n=null){const o=t?e.convertToWorldSpaceAR(cc.v2()):e.position,r=e.getContentSize();if(n){const e=n instanceof cc.Graphics,i=e?n:n.graph,c=!!e||n.is_fill||!0,s=!!e||n.is_fill||!0,a=e?cc.Color.WHITE:n.fill_color?this.quick_color(n.fill_color):cc.Color.WHITE,l=e?cc.Color.WHITE:n.stroke_color?this.quick_color(n.stroke_color):cc.Color.WHITE,_=e?1:n.stroke_width||1,u=i.node,d=t?u.parent.convertToNodeSpaceAR(o):u.parent.convertToNodeSpaceAR(u.convertToWorldSpaceAR(cc.v2()));i.fillColor=a,i.strokeColor=l,i.lineWidth=_,i.rect(d.x-r.width/2,d.y-r.height/2,r.width,r.height),c&&i.fill(),s&&i.stroke()}return cc.rect(o.x-r.width/2,o.y-r.height/2,r.width,r.height)}quick_color(e){return cc.color(e.r,e.g,e.b)}inside_checker(e,t,n=!0){const o=n?e.getBoundingBoxToWorld():this.quick_rect(e);return(n?t.getBoundingBoxToWorld():this.quick_rect(t)).containsRect(o)}to_roman_number(e){e=Math.floor(e);let t="";for(const n of roman_numerals)for(;e>=n.value;)t+=n.symbol,e-=n.value;return t}from_roman_number(e){e=e.toUpperCase();let t=0,n=0;for(;t<e.length;){for(const{value:o,symbol:r}of roman_numerals)if(e.startsWith(r,t)){n+=o,t+=r.length;break}t++}return n}}const ret=new pTSHelper;_G.pTS=ret,cc._opts={loading:{is:!1,__cbs:[],end:function(){this.is=!1;for(const e of this.__cbs)e&&e();this.__cbs=[]},add_callback_on_done:function(e,...t){if("function"==typeof e)this.__cbs.push(e);else if(Array.isArray(e))for(const n of e)this.__cbs.push(n);for(const n of t)this.__cbs.push(n)},start:function(){this.is=!0,this.__cbs=[]}}},cc._game={events:{item_skill:{auto_target:{on:"_auto_target_skill_invoked",off:"_auto_target_skill_offline"},freeze:{on:"_freeze_skill_invoked",off:"_freeze_skill_offline"}}}},cc.EditBox.Events={begin_editing:"editing-did-began",end_editing:"editing-did-ended",on_editing:"text-changed",return:"editing-return"};